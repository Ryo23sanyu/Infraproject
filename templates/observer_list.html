<!-- opinion.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}所見一覧{% endblock title %}
{% block h1 %}所見一覧{% endblock %}

{% block content %}
<style>
  table {
    border-collapse: collapse;  /* セルの重複枠線を取り除く */
    width: 100%;
  }
  th, td {
    border: 1px solid black;  /* 枠線の追加 */
    padding: 8px;  /* 内側の余白 */
    text-align: center;  /* テキスト中央揃え */
  }
  table.bordered-table th {
    background-color: #f2f2f2;  /* ヘッダーの背景色 */
  }

  .col-1 { width: 3%; } /* ● */
  .col-2 { width: 7%; } /* 主桁 01 */
  .col-3 { width: 10%; } /* 腐食(b,e) */
  .col-4 { width: 20%; } /* 写真 */
  .col-5 { width: 13%; } /* ボタン(B~E1) */ /*13%が限界*/
  .col-6 { width: 35%; } /* ボタン(原因) */
  .col-7 { width: 12%; } /* 所見 */
  
  .judge-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px; /* ボタン間の隙間を設定 */
    justify-content: center; /* コンテナー内でボタンを中央に配置 */
  }
  .judge-container button {
    width: 35px; /* 横幅を35pxに固定 */
    height: 35px; /* 高さを35pxに固定 */
    box-sizing: border-box; /* パディングとボーダーを含めてサイズを計算 */
    text-align: center; /* ボタン内のテキストを中央に配置 */
    flex: 0 0 auto; /* フレックスアイテムの伸縮を禁止し、設定したサイズを適用 */
  }
</style>

<table class="bordered-table">
  <thead>
    <tr>
        <th class="col-1">主要部材</th>
        <th class="col-2">損傷箇所</th>
        <th class="col-3">損傷種類</th>
        <th class="col-4">損傷写真</th>
        <th class="col-5">対策区分</th>
        <th class="col-6">損傷原因</th>
        <th class="col-7">所見</th>
    </tr>
  </thead>
  <tbody>
    {% for item in data %}
        {% comment %} 
        << views.py >>
        def observer_list(request):
        data = [
            {'parts_name': ['排水管'], 'damage_name': ['腐食'], 'damage_lank': ['b', 'c', 'e']}, 
            {'parts_name': ['排水管'], 'damage_name': ['防食機能の劣化'], 'damage_lank': ['e']}, 
            {'parts_name': ['添架物'], 'damage_name': ['ゆるみ・脱落'], 'damage_lank': ['e']}
        ]
        return render(request, 'observer_list.html', {'data': data}) 
    {% endcomment %}
    <tr>
        <td></td>
        <td>{{ item.parts_name.0 }}</td>
        <td>{{ item.damage_name.0 }}<br>{{ item.damage_lank }}</td>
        <td><img src="{% static 'images/sample.jpg' %}" alt="サンプル画像"></td>
        <td>
          <div class="judge-container">
            <button>B</button>
            <button>M</button>
            <button>C1</button>
            <button>S1</button>
            <button>C2</button>
            <button>S2</button>
            <button>E2</button>
            <button>E1</button>
          </div>
        </td>
        <td>
          <div class="cause-container">
            <button id="btn1" class="btn">疲労</button>
            <button id="btn2" class="btn">塩害</button>
            <button id="btn3" class="btn">凍害</button>
            <button id="btn4" class="btn">アルカリ骨材反応</button>
            <button id="btn5" class="btn">中性化</button>
            <button id="btn6" class="btn">材料劣化</button>
            <button id="btn7" class="btn">想定外の荷重</button>
            <button id="btn8" class="btn">衝突</button>
            <button id="btn9" class="btn">偏土圧・圧密沈下</button>
            <button id="btn10" class="btn">洗掘・浸食</button>
            <button id="btn11" class="btn">地震</button>
            <button id="btn12" class="btn">乾燥収縮・温度応力</button>
            <button id="btn13" class="btn">科学的腐食</button>
            <button id="btn14" class="btn">品質の経年変化</button>
            <button id="btn15" class="btn">製作・施工不良</button>
            <button id="btn16" class="btn">防水・排水工不良</button>
            <button id="btn17" class="btn">構造形式・形状不良</button>
            <button id="btn18" class="btn">人為的</button>
            <button id="btn19" class="btn">鳥害</button>
            <button id="btn20" class="btn">自由記述</button>
          </div>
        </td>
        <td>点錆が見られる。</td>
    </tr>
    {% endfor %}
</table>

<script>
    // 仮のitem.damage_name.0の値、実際の値はサーバーなどから取得してください
    let damageName = "{{ item.damage_name.0 }}";
    console.log('damageName:', damageName);

    // 必要に応じてボタンの表示/非表示を切り替える関数
    function updateButtonVisibility(damageName) {
      const buttons = document.querySelectorAll('.btn');

      // 全てのボタンを非表示にする
      buttons.forEach(button => {
        button.style.display = 'none';
      });

      // damageNameの値によって表示するボタンを指定
      switch (damageName) {
        case '腐食': // 1
          showButtons(['btn1', 'btn2', 'btn3', 'btn4', 'btn5']);
          break;
        case '亀裂': // 2
          showButtons(['btn1', 'btn7', 'btn8']);
          break;
        case 'ゆるみ・脱落': // 3
          showButtons(['btn6', 'btn7', 'btn8']);
          break;
          case '破断': // 4
          showButtons(['btn1', 'btn2', 'btn3', 'btn4', 'btn5']);
          break;
        case '防食機能の劣化': // 5
          showButtons(['btn1', 'btn7', 'btn8']);
          break;
        case 'ひびわれ': // 6
          showButtons(['btn6', 'btn7', 'btn8']);
          break;
          case '剥離・鉄筋露出': // 7
          showButtons(['btn1', 'btn2', 'btn3', 'btn4', 'btn5']);
          break;
        case '漏水・遊離石灰': // 8
          showButtons(['btn1', 'btn7', 'btn8']);
          break;
        case '抜け落ち': // 9
          showButtons(['btn6', 'btn7', 'btn8']);
          break;
          case '補修・補強材の損傷': // 10
          showButtons(['btn1', 'btn2', 'btn3', 'btn4', 'btn5']);
          break;
        case '床版ひびわれ': // 11
          showButtons(['btn1', 'btn7', 'btn8']);
          break;
        case 'うき': // 12
          showButtons(['btn6', 'btn7', 'btn8']);
          break;
          case '遊間の異常': // 13
          showButtons(['btn1', 'btn2', 'btn3', 'btn4', 'btn5']);
          break;
        case '路面の凹凸': // 14
          showButtons(['btn1', 'btn7', 'btn8']);
          break;
        case '舗装の異常': // 15
          showButtons(['btn6', 'btn7', 'btn8']);
          break;
          case '支承部の機能障害': // 16
          showButtons(['btn6', 'btn7', 'btn8']);
          break;
          case 'その他': // 17
          showButtons(['btn1', 'btn2', 'btn3', 'btn4', 'btn5']);
          break;
        case '定着部の異常': // 18
          showButtons(['btn1', 'btn7', 'btn8']);
          break;
        case '変色・劣化': // 19
          showButtons(['btn6', 'btn7', 'btn8']);
          break;
          case '漏水・滞水': // 20
          showButtons(['btn1', 'btn2', 'btn3', 'btn4', 'btn5']);
          break;
        case '異常な音・振動': // 21
          showButtons(['btn1', 'btn7', 'btn8']);
          break;
        case '異常なたわみ': // 22
          showButtons(['btn6', 'btn7', 'btn8']);
          break;
          case '変形・欠損': // 23
          showButtons(['btn6', 'btn7', 'btn8']);
          break;
          case '土砂詰まり': // 24
          showButtons(['btn1', 'btn2', 'btn3', 'btn4', 'btn5']);
          break;
        case '沈下・移動・傾斜': // 25
          showButtons(['btn1', 'btn7', 'btn8']);
          break;
        case '洗掘': // 26
          showButtons(['btn6', 'btn7', 'btn8']);
          break;
        default:
          console.log('Unexpected value');
      }
    }

    // 特定のボタンを表示するヘルパー関数
    function showButtons(buttonIds) {
      buttonIds.forEach(id => {
        const button = document.getElementById(id);
        if (button) {
          button.style.display = 'block';
        }
      });
    }

    // damageNameに基づいてボタンの表示を更新
    updateButtonVisibility(damageName);
</script>

{% endblock content %}