<!-- opinion.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}所見一覧{% endblock title %}
{% block h1 %}所見一覧{% endblock %}

{% block content %}
<style>
  table {
    border-collapse: collapse;  /* セルの重複枠線を取り除く */
    width: 100%;
  }
  th, td {
    border: 1px solid black;  /* 枠線の追加 */
    padding: 8px;  /* 内側の余白 */
    text-align: center;  /* テキスト中央揃え */
  }
  table.bordered-table th {
    background-color: #f2f2f2;  /* ヘッダーの背景色 */
  }

  .col-1 { width: 3%; } /* ● */
  .col-2 { width: 7%; } /* 主桁 01 */
  .col-3 { width: 10%; } /* 腐食(b,e) */
  .col-4 { width: 20%; } /* 写真 */
  .col-5 { width: 13%; } /* ボタン(B~E1) */ /*13%が限界*/
  .col-6 { width: 35%; } /* ボタン(原因) */
  .col-7 { width: 12%; } /* 所見 */
  
  .judge-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px; /* ボタン間の隙間を設定 */
    justify-content: center; /* コンテナー内でボタンを中央に配置 */
  }
  .judge-container button {
    width: 35px; /* 横幅を35pxに固定 */
    height: 35px; /* 高さを35pxに固定 */
    box-sizing: border-box; /* パディングとボーダーを含めてサイズを計算 */
    text-align: center; /* ボタン内のテキストを中央に配置 */
    flex: 0 0 auto; /* フレックスアイテムの伸縮を禁止し、設定したサイズを適用 */
  }
  /* ボタンの枠線、中の色を指定 */
  .btn {
      background-color: #4CAF50; /* ボタンの背景色 */
      border: 2px solid #4CAF50; /* ボタンの枠線の色と太さ */
      color: white; /* ボタンの文字色 */
      padding: 10px 20px; /* ボタン内のパディング */
      text-align: center; /* 文字の位置 */
      text-decoration: none; /* テキストの下線を消す */
      display: inline-block; /* ボタンをインラインブロック要素に */
      font-size: 16px; /* フォントサイズ */
      cursor: pointer; /* ポインタを指マークに */
      width: 150px; /* ボタンの幅を指定 */
      height: 50px; /* ボタンの高さを指定 */
      box-sizing: border-box; /* パディングとボーダーを含めたサイズ計算 */
      white-space: nowrap;       /* テキストの折り返しを無効にする */
  }
  
  /* ボタンを横並びにする */
  .button-container {
      display: flex; /* フレックスボックスを使用 */
      flex-wrap: wrap; /* 幅に収まりきらない場合は折り返す */
      justify-content: space-between; /* ボタンの間隔を均等にする */
      gap: 10px; /* 横並びのボタン間のギャップを設定 */
  }

</style>

<table class="bordered-table">
  <thead>
    <tr>
        <th class="col-1">主要部材</th>
        <th class="col-2">損傷箇所</th>
        <th class="col-3">損傷種類</th>
        <th class="col-4">損傷写真</th>
        <th class="col-5">対策区分</th>
        <th class="col-6">損傷原因</th>
        <th class="col-7">所見</th>
    </tr>
  </thead>
  <tbody>
    {% for item in data %}
        {% comment %} 
        << views.py >>
        def observer_list(request):
        data = [
            {'parts_name': ['排水管'], 'damage_name': ['腐食'], 'damage_lank': ['b', 'c', 'e']}, 
            {'parts_name': ['排水管'], 'damage_name': ['防食機能の劣化'], 'damage_lank': ['e']}, 
            {'parts_name': ['添架物'], 'damage_name': ['ゆるみ・脱落'], 'damage_lank': ['e']}
        ]
        return render(request, 'observer_list.html', {'data': data}) 
    {% endcomment %}
    <tr>
        <td></td>
        <td>{{ item.parts_name.0 }}</td>
        <td>{{ item.damage_name.0 }}<br>{{ item.damage_lank }}</td>
        <td><img src="C:\work\django\myproject\program\Infraproject\temp_image.png" alt="サンプル画像"></td>
        <td>
          <div class="judge-container">
            <button>B</button>
            <button>M</button>
            <button>C1</button>
            <button>S1</button>
            <button>C2</button>
            <button>S2</button>
            <button>E2</button>
            <button>E1</button>
          </div>
        </td>
        <td>
          <div class="button-container">
            <button id="btn{{ forloop.counter }}-1" class="btn">疲労</button>
            <button id="btn{{ forloop.counter }}-2" class="btn">塩害</button>
            <button id="btn{{ forloop.counter }}-3" class="btn">凍害</button>
            <button id="btn{{ forloop.counter }}-4" class="btn">アルカリ骨材反応</button>
            <button id="btn{{ forloop.counter }}-5" class="btn">中性化</button>
            <button id="btn{{ forloop.counter }}-6" class="btn">材料劣化</button>
            <button id="btn{{ forloop.counter }}-7" class="btn">想定外の荷重</button>
            <button id="btn{{ forloop.counter }}-8" class="btn">衝突</button>
            <button id="btn{{ forloop.counter }}-9" class="btn">偏土圧・圧密沈下</button>
            <button id="btn{{ forloop.counter }}-10" class="btn">洗掘・浸食</button>
            <button id="btn{{ forloop.counter }}-11" class="btn">地震</button>
            <button id="btn{{ forloop.counter }}-12" class="btn">乾燥収縮・温度応力</button>
            <button id="btn{{ forloop.counter }}-13" class="btn">科学的腐食</button>
            <button id="btn{{ forloop.counter }}-14" class="btn">品質の経年変化</button>
            <button id="btn{{ forloop.counter }}-15" class="btn">製作・施工不良</button>
            <button id="btn{{ forloop.counter }}-16" class="btn">防水・排水工不良</button>
            <button id="btn{{ forloop.counter }}-17" class="btn">構造形式・形状不良</button>
            <button id="btn{{ forloop.counter }}-18" class="btn">人為的</button>
            <button id="btn{{ forloop.counter }}-19" class="btn">鳥害</button>
            <button id="btn{{ forloop.counter }}-20" class="btn">自由記述</button>
          </div>
        </td>
        <td>点錆が見られる。</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
    // 特定のボタンを表示するヘルパー関数
    function showButtons(buttonIds) {
      buttonIds.forEach(id => {
          const button = document.getElementById(id);
          if (button) {
              button.style.display = 'block';
          }
      });
    }

    // 各行ごとのボタンの表示/非表示を切り替える関数
    function updateButtonVisibility(row, damageName, rowIndex) {
      const buttons = row.querySelectorAll('.btn');

      // 全てのボタンを非表示にする
      buttons.forEach(button => {
        button.style.display = 'none';
      });

      // damageNameの値によって表示するボタンを指定
      let buttonIds = [];
      switch (damageName) {
        case '腐食': // 1
          buttonIds = ['btn' + rowIndex + '-1', 'btn' + rowIndex + '-2', 'btn' + rowIndex + '-3', 'btn' + rowIndex + '-4', 'btn' + rowIndex + '-5', 'btn' + rowIndex + '-6', 'btn' + rowIndex + '-7'];
          break;
        case '防食機能の劣化': // 2
          buttonIds = ['btn' + rowIndex + '-1', 'btn' + rowIndex + '-7', 'btn' + rowIndex + '-8'];
          break;
        case 'ゆるみ・脱落': // 3
          buttonIds = ['btn' + rowIndex + '-6', 'btn' + rowIndex + '-7', 'btn' + rowIndex + '-8'];
          break;
        default:
          console.log('Unexpected value');
      }

      showButtons(buttonIds);
    }

    // 仮のitem.damage_name.0の値、実際の値はサーバーなどから取得してください
    let rows = document.querySelectorAll("tbody tr"); // tbody内のすべての行を取得
    rows.forEach((row, index) => {
        let cells = row.querySelectorAll("td"); // 行内のすべてのセルを取得
        if (cells.length >= 3) { // 3列目が存在するか確認
            let damageName = cells[2].textContent;
        
            // 正規表現で [ の前の部分を抽出
            let matches = damageName.match(/^[^\[]+/);
            if (matches) { // マッチする部分があるか確認
                damageName = matches[0].trim(); // 空白を取り除いて格納
            }

            console.log("log:", damageName); // 3列目のデータを表示（インデックス 2 が 3 列目）

            // damageNameに基づいてボタンの表示を更新
            updateButtonVisibility(row, damageName, index + 1);
        }
    });
</script>

{% endblock content %}