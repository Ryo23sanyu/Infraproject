{% load static %}
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <title>{% block title %}{% endblock title %}| インフラアプリ</title>
    <link rel="stylesheet" type="text/css" href="{% static 'infra/css/style.css' %}">
    <!--<link href="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.13.4/datatables.min.css" rel="stylesheet"/>
    <script src="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.13.4/datatables.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>-->
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/5.0.0/js/dataTables.fixedColumns.js"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/5.0.0/js/fixedColumns.dataTables.js"></script>
    <script src="https://cdn.datatables.net/rowreorder/1.5.0/js/dataTables.rowReorder.js"></script>
    <script src="https://cdn.datatables.net/rowreorder/1.5.0/js/rowReorder.dataTables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://cdn.datatables.net/2.0.3/css/dataTables.dataTables.css" rel="stylesheet"/>
    <link href="https://cdn.datatables.net/fixedcolumns/5.0.0/css/fixedColumns.dataTables.css" rel="stylesheet"/>
    <link href="https://cdn.datatables.net/rowreorder/1.5.0/css/rowReorder.dataTables.css" rel="stylesheet"/>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <Style>
      .my-table th, .my-table td {
          border: 3px double dimgray; /* ボーダースタイルを設定 */
          padding: 8px; /* セルの内側の余白を設定 */
      }
      .center-align {
          text-align: center;
      }
      .center-align img,
      .center-align textarea {
          margin: auto; /* 水平中央寄せ */
          display: block; /* ブロックレベル要素として扱う */
      }
  </style>
  <body>
    <nav class="navbar navbar-dark bg-success sticky-top">
      <div class="navbar-nav d-flex flex-row">
        {% if user.is_authenticated %}
        <a class="nav-link mx-3" href="{% url 'accounts:my_page' user.pk %}">マイページ</a>
        {% endif %}
        <a class="nav-link mx-3" href="{% url 'list-article' %}">案件一覧</a>
        <a class="nav-link mx-3" href="{% url 'create-article' %}">案件登録</a>
        <a class="nav-link mx-3" href="{% url 'file_upload' %}">アップロード</a>
        <a class="nav-link mx-3" href="{% url 'image_list' %}">写真一覧</a>
        <a class="nav-link mx-3" href="{% url 'table' %}">サンプル</a>
        <a class="nav-link mx-3" href="{% url 'number' %}">要素番号</a>
      </div>
      <div class="navbar-nav d-flex flex-row">
      {% if request.user.is_authenticated %}
        <a class="nav-link mx-3" href="{% url 'accounts:logout' %}">ログアウト</a>
        {% if user.is_superuser %}
        <a class="nav-link mx-3" href="/admin/">管理画面</a>
        {% endif %}
      {% else %}
          <a class="nav-link mx-3" href="{% url 'accounts:login' %}">ログイン</a>
          <a class="nav-link mx-3" href="{% url 'accounts:signup' %}">会員登録</a>
        {% endif %}
      </div>
    </nav>
    <div class='p-4'>
    <h1>{% block h1 %}{% endblock %}</h1>  
    {% block content %}{% endblock content %}
    </div>
  </body>
  <script>
      $(document).ready(function () {
          new DataTable('.my-table', {
              fixedColumns: true,
              "order": []
          });
      });
      function updatePlaceholder(select) {
          var input = document.getElementById('input_'+select.name.split('_')[1]); // 対応するinput要素を取得
          if (select.value === "width") {
              input.placeholder = "mm"; // 幅が選択された場合のプレースホルダー
          } else if (select.value === "area") {
              input.placeholder = "mm"; // 面積が選択された場合のプレースホルダー
          } else if (select.value === "bolt") {
            input.placeholder = "本"; // 本数が選択された場合のプレースホルダー
          } else if (select.value === "level") {
            input.placeholder = "mm"; // 段差量が選択された場合のプレースホルダー
          } else {
              input.placeholder = "単位"; // デフォルトのプレースホルダー
          }
      }
      document.addEventListener('DOMContentLoaded', (event) => {
        // 名称ごとに対応番号を定義したオブジェクト
        const namedConditions = {
          '排水管': ['①', '②', '③', '④'],
          '主桁': ['①', '⑤', '⑥'],
          '床版': ['②', '③', '④', '⑦']
        };
      
        // 全ての行を走査
        const rows = document.querySelectorAll('tr');
        rows.forEach(row => {
          // 名称と情報を含む<td>タグを取得
          const nameCell = row.querySelector('.sorting_1');
          const infoCell = row.querySelectorAll('td')[1];
      
          // 名称に対応する条件を取得
          const supportedNumbers = namedConditions[nameCell.textContent];
      
          // 条件に適合しない内容が含まれているかチェック
          if (supportedNumbers && infoCell) {
            const content = infoCell.innerHTML;
            let unsupported = supportedNumbers.every(number => !content.includes(number));
            
            // 対応できない内容が含まれている場合、修正案を表示
            if (unsupported) {
              console.log(`${nameCell.textContent}: 対応できない番号が含まれています。`);
              // ここで修正案を表示する処理を行う（例: alertやHTML内にメッセージを挿入）
      
              const div       = document.createElememt("div");
              div.textContent = "対応できません";
      
              nameCell.appendChild(div);
      
            } 
          }
        });
      });

      $(function () {
          $('#fileSelect').click(function () {
              $("#upload-file").click();
          });
          $('#upload-file').change(function () {
              if (confirm('写真を変更します')) {
                $('#ajax-file-send').on('submit', function(e) {//カッコ{ }内が実行する処理、upload-form(table.html)
                    e.preventDefault();//フォーム送信の通信を止める処理
                    var fd = new FormData($("#ajax-file-send").get(0));
                    //new FormData()の引数にはform要素のDOMを指定し、生成されたFormDataオブジェクトをfdに格納します。
                    //DOM(HTMLなどのドキュメントにJavaScriptからアクセスするための仕組み)
          
                    $.ajax({//生成したFormDataオブジェクトをAjaxを通して次のようにサーバーに送信
                        'url': '{% url "ajax_file_send" %}',
                        'type': 'POST',
                        'data': fd,//dataにはFormDataオブジェクトを指定
                        'processData': false,//dataを文字列への変換:falseにすることで変換されずにファイルとして送信される
                        'contentType': false,
                        'dataType': 'json'
                    })
                    .done(function(response){
                      //Ajax通信が成功した場合に実行する処理
                      console.log("ajax通信に失敗成功しました");
                    })
                    .fail(function (jqXHR, textStatus, errorThrown) {
                        console.log("ajax通信に失敗しました");
                        console.log("jqXHR          : " + jqXHR.status); // HTTPステータスが取得
                        console.log("textStatus     : " + textStatus);    // タイムアウト、パースエラー
                        console.log("errorThrown    : " + errorThrown.message); // 例外情報
                        // 通信失敗時の処理
                        alert('ファイルの取得に失敗しました。');
                    });
                });
                  console.log('uploaded!')
              } else {
                  $(this).val('');
                  console.log('reset!');
              }
          })
      });

      // ボタンをクリックしたときの処理
      document.getElementById('fileSelect').addEventListener('click', function() {
          // URL遷移
          window.location.href = ajaxFileSendUrl;
      });
      
      // もし削除ボタンもURL遷移したい場合は、同様に追加のイベントリスナーを定義
      document.getElementById('deleteButton').addEventListener('click', function() {
          // 別のURL遷移や動作
          // window.location.href = '別のURL';
      });

  </script>
</html>